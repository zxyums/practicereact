const _ = require('lodash');

/**
 * Updates statusCode for duplicates, ensuring only the first occurrence remains active.
 * @param {Array} data - The input array of objects.
 * @param {String} groupByKey - The key to group duplicates (e.g., "nonLatinLanguagesSupported").
 * @returns {Array} - Updated array with statusCode set to "1" for the first and "0" for duplicates.
 */
function updateDuplicateStatusCodes(data, groupByKey) {
  // Group the data by the specified key
  const grouped = _.groupBy(data, groupByKey);

  // Process each group to set statusCode
  return _.flatMap(grouped, (group) => {
    let isActiveSet = false; // Track if "1" has been assigned
    return group.map((item) => {
      if (!isActiveSet) {
        isActiveSet = true; // Set the first one as active
        return { ...item, statusCode: "1" };
      } else {
        return { ...item, statusCode: "0" }; // Deactivate the rest
      }
    });
  });
}

// Example Usage
const languages = [
  { draftLanguageId: 3399, nonLatinLanguagesSupported: "NL002:Japanese Katakana", statusCode: "1" },
  { draftLanguageId: 3399, nonLatinLanguagesSupported: "NL001:English", statusCode: "1" },
  { draftLanguageId: 3404, nonLatinLanguagesSupported: "NL016:Kannada", statusCode: "1" },
  { draftLanguageId: 3404, nonLatinLanguagesSupported: "NL012:Arabic", statusCode: "1" },
  { draftLanguageId: 3399, nonLatinLanguagesSupported: "NL001:English", statusCode: "1" },
  { draftLanguageId: 3399, nonLatinLanguagesSupported: "NL010:French", statusCode: "1" },
  { draftLanguageId: 3402, nonLatinLanguagesSupported: "NL010:French", statusCode: "1" },
  { draftLanguageId: 3393, nonLatinLanguagesSupported: "NL012:Arabic", statusCode: "1" }
];

// Call the method with the array and the key to group by
const updatedLanguages = updateDuplicateStatusCodes(languages, "nonLatinLanguagesSupported");

console.log(updatedLanguages);